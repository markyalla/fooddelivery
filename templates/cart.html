{% extends 'base.html' %}  

{% block content %}  
<h2>Your Cart</h2>  
{% if cart %}  
    <table class="table">  
        <thead>  
            <tr>  
                <th>Item</th>  
                <th>Price</th>  
                <th>Quantity</th>  
                <th>Subtotal</th>  
            </tr>  
        </thead>  
        <tbody>  
            {% for item_id, item in cart.items() %}  
            <tr>  
                <td>{{ item.name }}</td>  
                <td>${{ item.price }}</td>  
                <td>  
                    <form action="{{ url_for('update_cart_item', food_item_id=item_id) }}" method="post" style="display:inline;">  
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="0" required  
                               onchange="calculateTotals()">  
                        <button type="submit" class="btn btn-secondary">Update</button>  
                    </form>  
                </td>  
                <td>${{ item.price * item.quantity }}</td>  
            </tr>  
            {% endfor %}  
        </tbody>  
    </table>  
    <h4 id="total-amount">Total Amount: ${{ total_amount }}</h4>   

    <div class="row">  
        <div class="col-md-8">  
            <a href="{{ url_for('checkout') }}" class="btn btn-primary">Proceed to Checkout</a>  
        </div>  
        <div class="col-md-4">  
            <div class="card">  
                <div class="card-header">  
                    <h5>Payment Methods</h5>  
                </div>  
                <div class="card-body">  
                    <ul class="list-group">  
                        <li class="list-group-item">MTN MOMO</li>  
                        <li class="list-group-item">0541512558</li>  
                        <li class="list-group-item">Vodafone Cash</li>  
                        <li class="list-group-item">0500313515</li>  
                    </ul>  
                </div>  
            </div>  
        </div>  
    </div>  
    
{% else %}  
    <p>Your cart is empty.</p>  
{% endif %}  

<script>  
function calculateTotals() {  
    const rows = document.querySelectorAll('tbody tr');  
    let total = 0;  
    rows.forEach(row => {  
        const quantityCell = row.querySelector('input[name="quantity"]');  
        const priceCell = row.querySelector('td:nth-child(2)');  
        const subtotalCell = row.querySelector('td:nth-child(4)');  
        
        // Parse price and quantity  
        const price = parseFloat(priceCell.textContent.replace('$', ''));  
        const quantity = parseInt(quantityCell.value) || 0;  
        
        // Calculate subtotal  
        const subtotal = price * quantity;  
        
        // Update subtotal cell  
        subtotalCell.textContent = '$' + subtotal.toFixed(2);  
        
        // Add to total  
        total += subtotal;  
    });  
    
    // Update total amount displayed  
    document.querySelector('#total-amount').textContent = 'Total Amount: $' + total.toFixed(2);  
}  
</script>  

{% endblock %}